import{f as e,v as l,U as a,I as o,x as t,V as s,bP as n,bQ as i,an as u,c as r,o as d,F as c,b as v,K as m,B as p,H as b,a5 as g,G as y,i as w,w as f,bR as x,ar as h,as as k,d as S,C as B,t as T,bN as F,a as _,aH as V,s as A,J as N,E as q,ae as C,a1 as I,bS as E,bT as L,bU as $,bV as U,bW as j,bX as G,m as P,bY as R,bZ as W,b_ as M}from"./BMSK5C5y.js";import{u as z}from"./Bsq7yqCW.js";import{r as H,u as O}from"./CY_l4B6l.js";const Q={key:1,class:"ml-5px"},D={class:"text-20px"},J={class:"min-h-60px py-10px"},K={class:"text-16px"},X={class:"flex mt-10px"},Y=e({__name:"quickSwapButton",props:{quickBuyValue:{},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},styles:{default:""}},emits:["submitSwap"],setup(e,{emit:Y}){const{t:Z}=l(),ee=e,le=a(),ae=o(!1),oe=o(!1),te=o(""),se=t("noReminderQuickBuy",!1),{walletSwap:ne,loadingWalletSwap:ie}=z(),ue=s(),re=Y;function de(e){var l;if(e.stopPropagation(),re("submitSwap"),!C())return;if(ae.value)return;if(new I(ee.quickBuyValue||0).lte(0))return void E({title:"Error",type:"error",message:Z("amountMustG0")});const{row:a}=ee;te.value=Z("quickBuyMsg",{a:ee.quickBuyValue,m:(null==(l=F(ee.row.chain))?void 0:l.main_name)||"",s:a.symbol||(a.target_token==a.token0_address?a.token0_symbol:a.token1_symbol)}),se.value?me():oe.value=!0}const ce=o(),ve=n();async function me(){var e;if(oe.value=!1,ue.provider&&ue.address&&!le.evmAddress)return void async function(){const e=new I(ee.quickBuyValue||0).toFixed();ne(e,ee.row)}();const{chain:l}=ee.row;ae.value=!0,await async function(e){var l;const a=le.getWalletAddress(e);if(!a)return;const o=await R({chain:e,tokens:[U(e)],walletAddress:a}),t=(null==o?void 0:o[0])||{};ce.value={...t,symbol:null==(l=F(e))?void 0:l.main_name,chain:e,address:t.token||t.address,decimals:t.decimals||t.decimal}}(l);const a=ce.value,o=null==(e=new I(ee.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${(null==a?void 0:a.decimals)||18}})?`)))?void 0:e[0];return(Number(o)||0)<=0?(E({title:"Error",type:"error",message:Z("amountTooSmall")}),void(ae.value=!1)):new I(o||0).gt((null==a?void 0:a.balance)||0)?(E({title:"Error",type:"error",message:Z("insufficientBalance")}),void(ae.value=!1)):void async function(e){var l,a,o,t,s;const{chain:n}=ee.row,i="solana"===n,{botSettings:u}=ve,r=null==(a=null==(l=null==u?void 0:u[n])?void 0:l.buy)?void 0:a.selected,d=null==(t=null==(o=null==u?void 0:u[n])?void 0:o.buy)?void 0:t[r];if(i&&(null==d?void 0:d.mev)&&!(await le.getBundleAvailable()))return void(ae.value=!1);const{gasTip1List:c,gasTip2List:v}=L($().gasTip,"solana"),m=(null==d?void 0:d.mev)?c:v,p=(null==d?void 0:d.mev)?null==d?void 0:d.gas[0]:null==(s=null==d?void 0:d.gas)?void 0:s[1];let b={};if(i){let e=(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"0.002";(null==d?void 0:d.mev)&&new I(e).lt("0.002")&&(e="0.002"),b.priorityFee=new I(e).times(10**9).toFixed(0)}else{const e=0===Number(null==p?void 0:p.customFee)?"0":(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"3";b.gasTip=Number(new I(e).times(10**9).toFixed(0)),b.contractType=0,b.chain=n}const g=U(n),y=(null==d?void 0:d.slippage)||"9",w=le.getWalletAddress(n);if(!w)return;const f=Date.now().toString();b={...b,swapList:[{batchId:f,creatorAddress:w,inAmount:new I(e||0).times(10**ce.value.decimals||0).toFixed(0)}],inTokenAddress:g,outTokenAddress:ee.row.token||ee.row.target_token,swapType:1,isPrivate:(null==d?void 0:d.mev)||!1,slippage:"auto"!==y?Number(new I(y).times(100).toFixed(0)):900,autoSell:ve.autoSellConfig_autoSell||!1,autoSellConfig:null==ve?void 0:ve.autoSellConfig,autoGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellPriorityFee:i?b.priorityFee:b.gasTip};let x=j;i?x=W:"ton"===n&&(x=M);x(b).then((e=>function(e,l){var a;if(e){let o=setTimeout((()=>{E({type:"success",message:Z("transactionsSubmitted")}),pe.placeOrderUpdate++,ae.value=!1}),500);const t=(null==(a=null==ee?void 0:ee.row)?void 0:a.chain)||"",s=(null==e?void 0:e[0])||{},n={solana:"/botapi/swap/createSolTx",ton:"/botapi/swap/createSwapTonTx"};H({txInfo:s,chain:t,destination:(null==n?void 0:n[t])||"/botapi/swap/createSwapEvmTx",type:10});const i={[null==s?void 0:s.batchId]:null==s?void 0:s.id},u=P((()=>be.wsResult.tgbot),(e=>{var a,t,s,n,r;const d=e.batchId;if(d===l){if(o&&(clearTimeout(o),o=null),pe.placeOrderSuccess++,null==(t=null==(a=null==e?void 0:e.txList)?void 0:a[0])?void 0:t.success){E({type:"success",message:Z("tradeSuccess")});const l=null==(s=null==e?void 0:e.txList)?void 0:s[0];O({...l,chain:null==e?void 0:e.chain},(null==i?void 0:i[d])||"")}else G((null==(r=null==(n=null==e?void 0:e.txList)?void 0:n[0])?void 0:r.failMessage)||"swap error");u(),ae.value=!1}}))}}(e,f))).catch((e=>{G(e||"swap error"),ae.value=!1}))}(o)}const pe=i(),be=u();return(e,l)=>{const a=B,o=b,t=V,s=q;return d(),r(c,null,[v(o,{disabled:!Number(e.quickBuyValue),loading:w(ae)||w(ie),color:e.buttonBg,class:y(["flex items-center [&&]:px-12px",e.classNames]),style:g([{"--el-button-hover-bg-color":"#12B886","--el-button-hover-text-color":"#FFF","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},e.styles]),onClick:de},{default:f((()=>[x(e.$slots,"default",h(k({loading:w(ae)||w(ie)})),(()=>{var l;return[w(ae)||w(ie)?p("",!0):(d(),m(a,{key:0,class:"mr-4px",name:"mynaui:lightning-solid"})),S(" "+T(e.quickBuyValue||0)+" ",1),e.mainNameVisible?(d(),r("span",Q,T((null==(l=("getChainInfo"in e?e.getChainInfo:w(F))(e.row.chain))?void 0:l.main_name)||""),1)):p("",!0)]}))])),_:3},8,["disabled","loading","color","class","style"]),w(oe)?(d(),m(s,{key:0,modelValue:w(oe),"onUpdate:modelValue":l[1]||(l[1]=e=>A(oe)?oe.value=e:null),title:e.$t("buy"),width:"400px","append-to":e.appendTo},{header:f((()=>[_("span",D,T(e.$t("buy")),1)])),footer:f((()=>[v(o,{type:"primary",class:"w-full",size:"large",onClick:N(me,["stop"])},{default:f((()=>[S(T(e.$t("confirm1")),1)])),_:1})])),default:f((()=>[_("div",J,[_("div",K,T(w(te)),1),_("div",X,[v(t,{modelValue:w(se),"onUpdate:modelValue":l[0]||(l[0]=e=>A(se)?se.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:e.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])])),_:1},8,["modelValue","title","append-to"])):p("",!0)],64)}}});export{Y as _};
